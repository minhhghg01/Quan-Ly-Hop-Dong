<div class="dashboard-container">
    <div class="stats-grid" style="grid-template-columns: 1fr 2fr;">
        <div class="stat-card purple">
            <div class="card-title">T·ªïng gi√° tr·ªã Hƒê (Theo l·ªçc)</div>
            <div class="card-number" id="stat-contract">ƒêang t·∫£i...</div>
        </div>
        
        <div class="stat-card" style="padding: 15px; display:flex; flex-direction:column;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <span class="card-title" style="margin:0;">Bi·ªÉu ƒë·ªì H·ª£p ƒë·ªìng</span>
                
                <div style="display:flex; gap:5px;">
                    <select id="chart-view-mode" onchange="updateChartLogic()" style="padding:2px 5px; font-size:11px; height:25px; border-radius:4px;">
                        <option value="year">Theo NƒÉm</option>
                        <option value="quarter">Theo Qu√Ω</option>
                        <option value="month">Theo Th√°ng</option>
                    </select>

                    <select id="chart-year-select" onchange="updateChartLogic()" style="padding:2px 5px; font-size:11px; height:25px; border-radius:4px; display:none;">
                        </select>
                </div>
            </div>

            <div style="flex:1; position:relative;">
                <canvas id="contractChart"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="content-container">
    <div class="table-card">
        <div class="toolbar">
            <h3>Danh s√°ch H·ª£p ƒë·ªìng</h3>
            <div style="display:flex; gap:10px;">
                <button onclick="exportToExcel()" class="btn-primary-icon" style="background-color: #10b981;">
                    üìä Xu·∫•t Excel
                </button>
                
                <button onclick="openModal()" class="btn-primary-icon">
                    ‚ûï Th√™m H·ª£p ƒê·ªìng
                </button>
            </div>
        </div>

        <div class="table-responsive">
            <table class="excel-table">
                <thead>
                    <tr>
                        <th width="3%">STT</th>
                        <th width="14%">T√™n Hƒê</th>
                        <th width="10%">C√¥ng ty</th>
                        <th width="8%">Gi√° tr·ªã</th>
                        <th width="8%">Tags</th> <th width="7%">T.To√°n</th>
                        <th width="7%">Ng√†y K√Ω</th>
                        <th width="7%">H·∫øt h·∫°n</th>
                        
                        <th width="10%">Tr·∫°ng th√°i</th>
                        <th width="12%">Ghi ch√∫</th>
                        <th width="4%">File</th>
                    </tr>
                    
                    <tr class="filter-row">
						<th></th>
						<th><input type="text" id="f-title" onkeyup="filterContractTable()" placeholder="L·ªçc t√™n..."></th>
						<th><input type="text" id="f-company" onkeyup="filterContractTable()" placeholder="L·ªçc Cty..."></th>
						<th>
							<div class="filter-group-vertical">
								<input type="text" id="f-amount-min" placeholder="T·ª´..." onkeyup="formatCurrencyInput(this); filterContractTable()">
								<input type="text" id="f-amount-max" placeholder="ƒê·∫øn..." onkeyup="formatCurrencyInput(this); filterContractTable()">
							</div>
						</th>
						<th><input type="text" id="f-tags" onkeyup="filterContractTable()" placeholder="L·ªçc Tag..."></th>				
						<th>
							<div class="filter-group-vertical">
								<input type="date" id="f-pay-start" onchange="filterContractTable()">
								<input type="date" id="f-pay-end" onchange="filterContractTable()">
							</div>
						</th>
						<th>
							<div class="filter-group-vertical">
								<input type="date" id="f-sign-start" onchange="filterContractTable()">
								<input type="date" id="f-sign-end" onchange="filterContractTable()">
							</div>
						</th>
						<th>
							<div class="filter-group-vertical">
								<input type="date" id="f-exp-start" onchange="filterContractTable()">
								<input type="date" id="f-exp-end" onchange="filterContractTable()">
							</div>
						</th>						
						<th>
							<select id="f-status" onchange="filterContractTable()">
								<option value="">T·∫•t c·∫£</option>
								<option value="M·ªõi">M·ªõi</option>
								<option value="Ch·ªù thanh to√°n">Ch·ªù TT</option>
								<option value="Ho·∫°t ƒë·ªông">Ho·∫°t ƒë·ªông</option>
								<option value="S·∫Øp h·∫øt h·∫°n">S·∫Øp h·∫øt</option>
								<option value="H·∫øt h·∫°n">H·∫øt h·∫°n</option>
							</select>
						</th>
						<th><input type="text" id="f-note" onkeyup="filterContractTable()"></th>
						<th></th>
					</tr>
                </thead>
                <tbody id="table-contract-body"></tbody>
            </table>
        </div>
		
		<div class="pagination-wrapper">
			<div class="rows-per-page">
            Hi·ªÉn th·ªã: 
            <select id="rows-select" onchange="changeRowsPerPage()">
                <option value="20">20 d√≤ng</option>
                <option value="50">50 d√≤ng</option>
                <option value="100">100 d√≤ng</option>
                <option value="200">200 d√≤ng</option>
                <option value="all">T·∫•t c·∫£</option>
            </select>
            
            <span style="margin-left: 8px; color: #4b5563; font-size: 13px;">
            T·ªïng: <b id="lbl-total-records" style="color: #2563eb;">0</b> b·∫£n ghi
            </span>
        </div>

			<div id="pagination" class="pagination-container"></div>
		</div>
		
    </div>
</div>

<div id="modal-contract" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="form-title">Th√™m m·ªõi H·ª£p ƒë·ªìng</h3>
            <span class="close-btn" onclick="closeModal()">&times;</span>
        </div>
        
        <div id="form-contract">
            <input type="hidden" id="c-id">
            <div class="input-grid">
                <input type="text" id="c-title" placeholder="T√™n h·ª£p ƒë·ªìng" class="span-2">
                <input type="text" id="c-company" placeholder="T√™n c√¥ng ty" class="span-2">
                <div class="input-group-col"><input type="text" id="c-amount" placeholder="Gi√° tr·ªã..." onkeyup="formatCurrencyInput(this)" onkeydown="handleAmountShortcuts(event)"></div>
                <select id="c-status">
                    <option value="M·ªõi">M·ªõi</option>
                    <option value="Ch·ªù thanh to√°n">Ch·ªù thanh to√°n</option>
                    <option value="Ho·∫°t ƒë·ªông">Ho·∫°t ƒë·ªông</option>
                    <option value="S·∫Øp h·∫øt h·∫°n">S·∫Øp h·∫øt h·∫°n</option>
                    <option value="H·∫øt h·∫°n">H·∫øt h·∫°n</option>
                </select>
                <div class="date-group"><label>Ng√†y k√Ω:</label><input type="date" id="c-signDate"></div>
                <div class="date-group"><label>Thanh to√°n:</label><input type="date" id="c-paymentDate"></div>
                <div class="date-group"><label>H·∫øt h·∫°n:</label><input type="date" id="c-expireDate"></div>
                <div class="date-group"><label style="color:red">Ng√†y nh·∫Øc:</label><input type="date" id="c-reminderDate"></div>
                <input type="text" id="c-tags" placeholder="Tags">
                <input type="file" id="c-image">
                <input type="text" id="c-note" placeholder="Ghi ch√∫" class="span-3">
            </div>
            <div class="modal-footer">
                <button onclick="saveContract()" id="btn-save-contract" class="btn-save">L∆∞u H·ª£p ƒê·ªìng</button>
                <button onclick="closeModal()" class="btn-cancel">ƒê√≥ng</button>
            </div>
        </div>
    </div>
</div>

<div id="context-menu">
    <div class="ctx-item" onclick="handleContextAction('edit')">‚úèÔ∏è S·ª≠a</div>
    <div class="ctx-item" onclick="handleContextAction('duplicate')">üìã Nh√¢n b·∫£n</div>
</div>