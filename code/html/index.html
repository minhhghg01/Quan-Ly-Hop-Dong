<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>H·ªá Th·ªëng Qu·∫£n L√Ω</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/table.css">
</head>

<body>
    <div id="toast" class="toast">‚úÖ L∆∞u th√†nh c√¥ng!</div>

    <div class="main-wrapper">
        <div class="main-tabs">
            <button class="main-tab-btn" id="btn-main-contract" onclick="loadPage('contract')">
                <span>üìú</span> Qu·∫£n L√Ω H·ª£p ƒê·ªìng
            </button>
            <button class="main-tab-btn" id="btn-main-fund" onclick="loadPage('fund')">
                <span>üí∞</span> Qu·∫£n L√Ω Qu·ªπ Ph√≤ng
            </button>
            <button class="main-tab-btn" id="btn-main-history" onclick="loadPage('history')">
                <span>üï∞Ô∏è</span> L·ªãch S·ª≠ H·ªá Th·ªëng
            </button>
        </div>

        <div id="app-container">
            <div style="text-align:center; padding:50px; color:#999;">ƒêang t·∫£i giao di·ªán...</div>
        </div>
    </div>

    <button id="btn-back-to-top" onclick="scrollToTop()" title="L√™n ƒë·∫ßu trang">‚¨Ü</button>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="../js/utils.js"></script>
    <script src="../js/contract.js"></script>
    <script src="../js/fund.js"></script>
    <script src="../js/history.js"></script>

    <script>
        // H√†m n·∫°p giao di·ªán HTML t·ª´ file con
        async function loadPage(pageName) {
            // 1. Highlight n√∫t menu
            document.querySelectorAll('.main-tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-main-${pageName}`).classList.add('active');

            // 2. T·∫£i file HTML t∆∞∆°ng ·ª©ng
            const container = document.getElementById('app-container');
            container.innerHTML = '<div style="text-align:center; padding:20px;">‚è≥ ƒêang t·∫£i...</div>';

            try {
                const response = await fetch(`${pageName}.html`); // T·∫£i contract.html ho·∫∑c fund.html
                if (!response.ok) throw new Error("Kh√¥ng t·∫£i ƒë∆∞·ª£c file");
                const html = await response.text();

                // 3. Nh√©t HTML v√†o khung
                container.innerHTML = html;

                // 4. K√≠ch ho·∫°t logic JS t∆∞∆°ng ·ª©ng
                if (pageName === 'contract') {
                    if (typeof loadContracts === 'function') loadContracts();
                } else if (pageName === 'fund') {
                    if (typeof loadTransactions === 'function') loadTransactions();
                } else if (pageName === 'history') {
                    if (typeof loadHistory === 'function') loadHistory();
                }

                // L∆∞u tr·∫°ng th√°i
                localStorage.setItem('lastPage', pageName);

            } catch (err) {
                container.innerHTML = `<div style="color:red; text-align:center">L·ªói: ${err.message}</div>`;
            }
        }

        // M·∫∑c ƒë·ªãnh t·∫£i trang cu·ªëi c√πng ho·∫∑c contract
        document.addEventListener("DOMContentLoaded", () => {
            const lastPage = localStorage.getItem('lastPage') || 'contract';
            loadPage(lastPage);
        });
    </script>
</body>

</html>